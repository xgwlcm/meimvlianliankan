document.addEventListener?document.addEventListener("DOMContentLoaded",function(){var l="",s=180,o=0,r=null,c=$(".piece"),f=$(".wrap")[0],v=function(e,t,n){for(var a=[],i=0,r=0;r<e;r++)for(var c=0;c<e;c++)a.push({x:c*t,y:r*n,index:i}),i++;return a}(3,28,20);$(".img-wrap").on("click",function(e){for(var t=$(".img-wrap"),n=0,a=t.length;n<a;n++)t[n].className=t[n].className.replace(" active","");/active/g.test(this.className)||(this.className+=" active"),l=e.target.src}),$("#file").on("change",function(e){var t=this.files[0],n=new FileReader;n.onload=function(e){$(".file-wrap")[0].style.backgroundImage="url("+n.result+")",l=n.result},t&&n.readAsDataURL(t)}),$("#start").on("click",function(e){o=-100,l?(r=setInterval(t,1e3),m(f,o+"vw"),$(".piece").css("backgroundImage","url("+l+")"),n(c,v)):alert("请选择图片")});var u=0,g=null;function m(e,t){e.style.transform="translateX("+t+")"}function t(){--s,$("#time").html(s),s<1&&(clearInterval(r),alert("挑战失败，请返回重新开始"))}function e(){s=180,$("#time").html(s)}function n(e,t){!function(e){e.sort(function(e,t){return.5<Math.random()?-1:1})}(t);for(var n=0,a=e.length;n<a;n++){var i=e[n];i.setAttribute("index",n),i.style.transform="translate("+t[n].x+"vw,"+t[n].y+"vh)"}}c.on("click",function(e){if(u){u=0;var t=+g.getAttribute("index"),n=+this.getAttribute("index");!function(e,t,n){var a=e[t];e[t]=e[n],e[n]=a}(v,t,n),g.style.transform="translate("+v[t].x+"vw,"+v[t].y+"vh)",this.style.transform="translate("+v[n].x+"vw,"+v[n].y+"vh)",g.className=g.className.replace(" active",""),function(e){return e.every(function(e,t){return e.index===t})}(v)&&(clearInterval(r),o-=100,$("#playArea")[0].classList.add("active"),$("#use_time").html(180-s),setTimeout(function(){m(f,o+"vw")},1200))}else{u=1,g=this;for(var a=0,i=c.length;a<i;a++)c[a].className=c[a].className.replace(" active","");/active/g.test(this.className)||(this.className+=" active")}}),$("#change").on("click",function(){n(c,v)}),$("#back").on("click",function(){clearInterval(r),e(),m(f,(o+=100)+"vw")}),$("#generate").on("click",function(){!function(){var n=document.createElement("canvas");if(n.getContext){var a=window.innerWidth,i=window.innerHeight,r=n.getContext("2d");n.width=a,n.height=i;var e=r.createLinearGradient(0,0,0,i);e.addColorStop(0,"#a1c4fd"),e.addColorStop(1,"#c2e9fb"),r.fillStyle=e,r.fillRect(0,0,a,i),r.fill();var c=0;img=new Image,img.src=l,img.onload=function(){c=.6*a*this.height/this.width,r.drawImage(img,.2*a,.1*i,.6*a,c),r.save(),r.fillStyle="#fff",r.font="20px Helvetica",r.textBaseline="hanging",r.textAlign="center",r.fillText("我只用了"+(180-s)+"s,快来挑战！",a/2,.15*i+c),r.restore(),r.save(),r.fillStyle="#000",r.font="14px Helvetica",r.textBaseline="hanging",r.textAlign="center",r.fillText("开始游戏",a/2,.25*i+c),r.restore(),function(){var t=new Image;t.src="./images/logo.png",t.onload=function(){r.drawImage(t,.35*a,.3*i+c,.3*a,.3*a);var e=new Image;e.src=function(e,t){var n=new Image;return n.src=e.toDataURL("image/png",t),n}(n,1).src,e.className="previewImg",e.onload=function(){$(".preview-page")[0].appendChild(this),m(f,(o-=100)+"vw")}}}()}}else alert("浏览器不支持canvas！")}()}),$("#again").on("click",function(){o=0,e(),m(document.body,o+"vw")})}):alert("请升级浏览器！");